import React, { useState, useContext, useEffect } from "react";

import { ReactComponent as IconBIG } from "../icons/ico-menu-alert.svg";
import { ReactComponent as Loader } from "../icons/loader_typea.svg";

import ResourceGroup_Action_btns from "../ResourceGroup/ResourceGroup_Action_btns.jsx";
import ResourceGroup_buttomLine from "../ResourceGroup/ResourceGroup_buttomLine.jsx";
import axios from "axios";
import GeneralContext from "../../Context.js";
import CodeMirror from "@uiw/react-codemirror";
import { json, jsonLanguage, jsonParseLinter } from "@codemirror/lang-json";
import { tags as t } from "@lezer/highlight";
import { createTheme } from "@uiw/codemirror-themes";
import "../StatusDisplay.css";
import JsonView from "@uiw/react-json-view";
// Adjust the path as needed based on your project structure
import "./../Settings/Settings.css";
import "./../Settings/custom-json-view.css";
import {
  PopUp_All_Good,
  PopUp_Alert_info,
  PopUp_loader,
  PopUp_Error,
} from "../PopUp_Smart.js";

export function ShowRuleModal({ RuleType }) {
  const { backEndURL, all_Tools, front_IP } = useContext(GeneralContext);

  const [Preview_This_in_menu, set_Preview_This_in_menu] = useState("");
  const [SubMenuOptionsList, setSubMenuOptionsList] = useState([]);
  const [ActiveAlertConfig, setActiveAlertConfig] = useState({});
  const [object, setObject] = useState({});

  const [PopUp_Error____show, set_PopUp_Error____show] = useState(false);
  const [PopUp_Error____txt, set_PopUp_Error____txt] = useState({
    HeadLine: "",
    paragraph: "",
    buttonTitle: "",
  });
  const [PopUp_All_Good__show, set_PopUp_All_Good__show] = useState(false);
  const [PopUp_All_Good__txt, set_PopUp_All_Good__txt] = useState({
    HeadLine: "Success",
    paragraph: "successfully",
    buttonTitle: "Close",
  });

  const myTheme = createTheme({
    theme: "dark",
    settings: {
      background: "transperent",
      backgroundImage: "",
      foreground: "var(--color-Grey1)",
      caret: "var(--color-DB-Blue-Active)",
      selection: "var(--color-Grey4)",
      selectionMatch: "var(--color-Grey2)",
      lineHighlight: "transperent",
      gutterBackground: "var(--color-Grey5)",
      gutterForeground: "var(--color-Grey1)",
    },
    styles: [
      { tag: t.comment, color: "var(--color-White)" },
      { tag: t.variableName, color: "var(--color-White)" },
      {
        tag: [t.string, t.special(t.brace)],
        color: "var(--color-DB-Blue-Active)",
      },
      { tag: t.number, color: "var(--color-White)" },
      { tag: t.bool, color: "var(--color-White)" },
      { tag: t.null, color: "var(--color-White)" },
      { tag: t.keyword, color: "var(--color-White)" },
      { tag: t.operator, color: "var(--color-White)" },
      { tag: t.className, color: "var(--color-White)" },
      { tag: t.definition(t.typeName), color: "#5c6166" },
      { tag: t.typeName, color: "var(--color-White)" },
      { tag: t.angleBracket, color: "var(--color-White)" },
      { tag: t.tagName, color: "var(--color-White)" },
      { tag: t.attributeName, color: "var(--color-White)" },
    ],
  });
  const customTheme = {
    "--w-rjv-font-family": "roboto",

    "--w-rjv-background-color": "",
    "--w-rjv-line-color": "var(--color-Grey3)",
    "--w-rjv-arrow-color": "var(--w-rjv-color)",
    "--w-rjv-edit-color": "var(--color-Grey1)",
    "--w-rjv-add-color": "var(--color-Grey1)",
    "--w-rjv-delete-color": "var(--color-Grey1)",
    "--w-rjv-info-color": "red",
    "--w-rjv-update-color": "var(--color-Grey1)",
    "--w-rjv-copied-color": "var(--color-Grey1)",
    "--w-rjv-copied-success-color": "var(--color-Grey1)",

    "--w-rjv-curlybraces-color": "var(--color-Grey1)",
    "--w-rjv-colon-color": "var(--color-Grey1)",
    "--w-rjv-brackets-color": "var(--color-Grey1)",

    "--w-rjv-type-int-color": "var(--color-DB-Blue-Active)",
    "--w-rjv-type-float-color": "var(--color-DB-Blue-Active)",
    "--w-rjv-type-bigint-color": "var(--color-DB-Blue-Active)",
    "--w-rjv-type-boolean-color": "var(--color-DB-Blue-Active)",
    "--w-rjv-type-date-color": "var(--color-DB-Blue-Active)",
    "--w-rjv-type-url-color": "var(--color-DB-Blue-Active)",
    "--w-rjv-type-null-color": "var(--color-DB-Blue-Active)",
    "--w-rjv-type-nan-color": "var(--color-DB-Blue-Active)",
    "--w-rjv-type-undefined-color": "var(--color-DB-Blue-Active)",
    "--w-rjv-type-string-color": "var(--color-DB-Blue-Active)",
    "--w-rjv-type": "var(--color-DB-Blue-Active)",

    "--w-rjv-object-key": "var(--color-Grey1)",
    "--w-rjv-key-string": "var(--color-Grey1)",

    "--w-rjv-color": "var(--color-Orange)",

    "--w-rjv-quotes-color": "var(--color-Grey1)",
  };

  useEffect(() => {
    if (backEndURL) {
      GetFileContent(RuleType);
    }
  }, [backEndURL]);

  const GetFileContent = async (id) => {
    try {
      console.log("RuleType", id);

      const res = await axios.post(backEndURL + "/results/GetRules", {
        id,
      });
      console.log(
        "GetFileContent GetFileContent GetFileContent GetFileContent",
        res.data
      );
      if (typeof res?.data == "object") {
        setObject(res?.data ?? {});
      } else {
        setObject({ error: "File does not exist" });
      }
    } catch (error) {
      console.log("Error In GetFileContent :", error);
    }
  };

  return (
    <div
      // className="app-main"
      style={
        {
          // flexDirection:"row"
        }
      }
    >
      {PopUp_All_Good__show && (
        <PopUp_All_Good
          popUp_show={PopUp_All_Good__show}
          set_popUp_show={set_PopUp_All_Good__show}
          HeadLine={PopUp_All_Good__txt.HeadLine}
          paragraph={PopUp_All_Good__txt.paragraph}
          buttonTitle={PopUp_All_Good__txt.buttonTitle}
        />
      )}
      {PopUp_Error____show && (
        <PopUp_Error
          popUp_show={PopUp_Error____show}
          set_popUp_show={set_PopUp_Error____show}
          HeadLine={PopUp_Error____txt.HeadLine}
          paragraph={PopUp_Error____txt.paragraph}
          buttonTitle={PopUp_Error____txt.buttonTitle}
        />
      )}

      <div className="resource-group-top-boxes mb-c"></div>
      <div>
        <table className="setting_table  " style={{ lineHeight: "100%" }}>
          <tbody>
            <tr>
              <td className="setting_descriptions">
                <p className="font-type-h4 Color-White mb-c">{RuleType}</p>
                <p className="font-type-txt Color-Grey1 mb-b">
                  AI Created {RuleType}
                </p>
                <p className="font-type-txt Color-Orange">
                  {" "}
                  Caution: Please note that the accuracy of these rules cannot
                  be guaranteed as they were generated using AI.
                </p>
              </td>

              <td
                className="setting_element PreviewBox"
                style={{ height: "auto", width: "68.5vw" }}
              >
                <div className=" ">
                  <div
                    className="setting_element"
                    style={{ overflowY: "scroll" }}
                  >
                    <JsonView
                      value={object}
                      keyName="root"
                      style={customTheme}
                      displayDataTypes={false}
                      enableClipboard={false}
                      name={false}
                      Ellipsis={false}
                    />{" "}
                  </div>
                  {/* {preview_or_edit ? (
                    <>
                      <div
                        className="setting_element"
                        style={{ overflowY: "scroll" }}
                      >
                        <JsonView
                          value={object}
                          keyName="root"
                          style={customTheme}
                          displayDataTypes={false}
                          enableClipboard={false}
                          name={false}
                          Ellipsis={false}
                        />{" "}
                      </div>
                    </>
                  ) : (
                    <>
                      {ErrString && (
                        <div
                          style={{
                            // width: "auto",
                            backgroundColor: "var(--color-Orange)",
                            color: "#FFFFFF",
                            opacity: 0.7,
                            position: "absolute",
                            zIndex: 5555555,
                            padding: 10,
                          }}
                        >
                          {ErrString}
                        </div>
                      )}

                      <CodeMirror
                        value={JSON.stringify(object, null, 2)}
                        height="600px"
                        // width="100%"
                        // maxWidth="auto"

                        onChange={async (x) => {
                          try {
                            console.log("flip", JSON.parse(x));
                            set_config_save_btn(true);
                            setObject(JSON.parse(x));
                            setErrString("");
                          } catch (error) {
                            set_config_save_btn(false);
                            setErrString(error.toString());
                            console.log("Json Error", error.toString());
                          }
                        }}
                        extensions={[json()]}
                        theme={myTheme} // Custom Style For The Editor
                        // theme={vscodeDark} // Pre made style for the editor
                        highlightActiveLine={true}
                      />
                    </>
                  )} */}
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  );
}

// "Custom.10Root.Timestomping.Scenario"
